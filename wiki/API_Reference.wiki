Before start, you may want to check out http://tools.ietf.org/html/draft-hammer-oauth-10 to understand OAuth protocol 1.0 to understand how Fitbit authorizes your app to access to users' data. 

=Member Functions=
==Constructor==

<strong>
FitJS_OAuth(callbackUrl, consumerKey, hashMethod)
</Strong>

*_Parameters:_*
|| callbackUrl || an URL for Fitbit API to callback once the user authorize the access to his/her data. The URL should match what's on record unless no record left on Fitbit.com.  This URL should write the token and verifier returned by Fitbit to database ||
||consumerKey||the consumer key string provided by Fitbit||
||hashMethod||FitJS currently *ONLY ACCEPTS HMAC-SHA1*. However, HMAC-SHA1, RSA-SHA1, PLAINTEXT will be supported in the future||
*_Return:_*
A initialized copy of Fitbit instance

*_Example:_*
{{{
    foauth=new FitJS_OAuth("http://example.com/oauthcomplete.php",  //callback url
                                "7c799999999999e8a149499999", //consumer key
                                "HMAC-SHA1" //hash method
                                );
}}}

==Signing a request==
An OAuth request usually involves several headers. But the complex parts are
1)  assembling a request base string 
2)  signing it. 
3)  assembling a request header

2) needs your secret. For security reasons, it is highly commended to not store your OAuth secret in the javascript. For this sake, you should store your Fitbit OAuth secret in "oauthsignature.php". 

For more information about signing OAuth request, please see:

http://tools.ietf.org/html/draft-hammer-oauth-10#section-3.4

===Generating a base string===

<strong>
oauthBaseString(stage);
</strong>
This function will generate a base string for signing based on the type of request. 

*_Parameters:_*
||stage|| This is an Enum variable with two possible values: "request_token" and "access_token".  ||

*_Return:_*
The function will return a base string for generating signature string based on the type of request provided. 

*_Example:_*
{{{
var baseString=foauth.oauthBaseString("request_token");
var basestring=foauth.oauthBaseString("access_token");
}}}


<strong>
oauthSignatureString (baseString)
</strong>
This function will sign the base string by using HMAC-SHA1. Currently, HMAC-SHA1 is the only method allowed in the 1.0 version of FitJS. 

*_Parameters:_*
||baseString|| Oauth request base string to generate signature. This string is generated by oauthBaseString() function||

*_Return:_*
A signature string by using HMAC-SHA1 

*_Example:_*
{{{
 var signature=foauth.oauthSignatureString(baseString);
}}}


==Requesting a temporary token==

<strong>
requestToken (signature, async, onreadyStateChange)
</strong>

*_Parameters:_*
||signature|| the signature string based on this request's base string||
||async|| whether this request is asynchronous||
||onreadyStateChange|| callback function for ready state change event. Only if the request is asynchronous, this function will called. ||

*_Return:_*
If the request is asynchronous, this function does not have return. If the function is synchronous, the return is a standard XMLHttpRequest

*_Example:_*
{{{
foauth.requestToken(signature, true, readyStategChange);  
}}}

==Authorizing Access==
Through the OAuth authorization process, user has to give your app the permission to access his/her data on Fitbit server. Thus, your app needs to either redirect the user to or use a pop-up window to allow the user access to fitbit.com/authorize. 

<strong>
authorize(usePopUp, locale, mobile, popupWidth, popupHeight)
</strong>

This function allows both pop-up and redirect, although using pop-up is highly recommended to preserve data in your javascript. 

*_Parameters:_*
||usePopUp|| whether the access to fitbit.com is through a pop-up or redirect||
||locale|| the locale of your pop-up ||
||mobile|| whether the user's access to fitbit.com is on a mobile device||
||popupWidth|| the width of your pop-up||
||popupHeight|| the heigh of your pop-up||

*_Return:_*
None

*_Example:_*
{{{
foauth.authorize(true, "en_US", false, 800, 500);
}}}



<strong>
checkOAuthVerifier(interval, timeout, onTimedOut, onFinished, onFailed)
</strong>

This function sends requests to "oauthverifier.php" to check whether your website as acquired OAuth verifier from fitbit.com (this occurs only after user has authorized the access). Thus, the prerequisite is to implement  a callback URL that allows fitbit.com to send verifier and token and "oauthverifier.php", which pulls data from your database where the verifier and token are stored. 

Note that "oauthverifier.php" MUST RETURN VERIFIER AND TOKEN IN FOLLOWING FORMAT:

"verifier=XXX&token=XXX"


*_Parameters:_*
||interval|| frequency to check on "oauthverifier.php" in milliseconds ||
||timeout|| the threshold to timeout of a single request in milliseconds||
||onTimedOut|| callback function if it does timeout (return XMLHttpRequest)||
||onFinished|| callback function when finish (return XMLHttpRequest)||
||onFailed|| callback function when error occurs (return XMLHttpRequest) ||

*_Return:_*

None

*_Example:_*
{{{
foauth.checkOAuthVerifier(2000, 10000, onTimeOut, onFinished, onFailed);
}}}


<strong>
stopCheckingOAuthVerifier()
</strong>

checkOAuthVerifier() will automatically stop sending requests if it acquires verifier and token from the "oauthverifier". However, should you want to stop the checking manually under certain circumstances, you can call this function. 


*_Parameters:_*

None

*_Return:_*
None

*_Example:_*
{{{
stopCheckingOAuthVerifier();
}}}



==Accessing a token===
<strong>
accessToken(signature, async, onreadyStateChange)
</strong>

The last step in the OAuth process is to request and receives token credentials from Fitbit. The return includes token, token secret and the user's user-id. With these credentials, your app can then access user's data. 

*_Parameters:_*
||signature|| signature string generated by "oauthSignatureString()" ||
||async|| whether this request is asynchronous||
||onreadyStateChange|| if the request is asynchronous, the callback function to receive read state change event. The argument will be a standard XMLHttpRequest||

*_Return:_*
If the request is synchronous, the function returns a standard XMLHttpRequest; if not, it does not return anything. 

*_Example:_*

{{{
foauth.accessToken(signature, true, onAccessTokenFinished);

function onAccessTokenFinished(xmlhttp)
{
        if (xmlhttp.readyState===4 && xmlhttp.status===200)
    {
        alert("token:"+foauth.oauth_token+" token secret:"+foauth.oauth_token_secret+" user id: "+foauth.encoded_user_id);    
    }
}


}}}


=Member Variables=
   {{{
   url={
        request_token:"http://api.fitbit.com/oauth/request_token",
        access_token:"http://api.fitbit.com/oauth/access_token",        
        authorize:"https://www.fitbit.com/oauth/authenticate",
        verifier:"fitjs/oauthverifier.php",
        signature:'fitjs/oauthsignature.php',
        proxy:"fitjs/proxy.php"        
    }
}}}
---- 
    {{{
callbackUrl
}}}

---- 

{{{
    consumerKey
}}}

---- 
{{{
    hashMethod
}}}

---- 
{{{
    verifier
}}}

---- 
{{{
    token
}}}

---- 
{{{
    callbackConfirmed
}}}

---- 
{{{
    checkVerifier
}}}

---- 
{{{
    request_token_timestamp
}}}

---- 
{{{
    request_token_nonce
}}}

---- 
{{{
    access_token_timestamp
}}}

---- 
{{{
    access_token_nonce
}}}
---
{{{
oauth_token_secret
}}}

---- 

{{{
encoded_user_id
}}}